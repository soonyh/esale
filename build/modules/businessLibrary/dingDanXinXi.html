<form id="container-dingDanXinXi"><label class="form-group"><div class="icon-label"><i class="iconfont icon-shijianxuanze"></i></div><div class="wrapper"><input class="form-control color-green" placeholder="上门安装时间" type="text" name="orderTime"><div class="other"><i class="iconfont icon-xiangyou1"></i></div></div></label><label class="form-group" id="sdfwer" style="display:none"><div class="icon-label"><i class="iconfont icon-time"></i></div><div class="wrapper"><input class="form-control" placeholder="空闲时间段" type="text" name="timeRange" data-toggle="select"><div class="other"><i class="iconfont icon-xiangyou1"></i></div></div></label><div class="form-group" onclick="DingDanXinXi.showModal1()"><div class="icon-label"><i class="iconfont icon-fazhanren"></i></div><div class="wrapper"><input class="form-control" data-toggle="select-popup" placeholder="发展人姓名" type="text" name="faZhanRenName" readonly=""><div class="other"><i class="iconfont icon-chaxun color-orange"></i></div></div></div><div class="form-group"><div class="icon-label"><i class="iconfont icon-liebiao"></i></div><div class="wrapper"><div class="input-label">添加经办人</div><div class="other color-orange" id="matchRate"></div></div></div><div class="sub-area border-bottom" style="margin-top:1px"><div class="operator-box"><div class="card-camera"><div class="card-box" id="id-kksiwes"><i class="iconfont"></i></div><p>身份证照片 <a onclick="DingDanXinXi.getGenerationInfos()" href="javascript:;">模拟</a> <span><i class="iconfont icon-chuanma color-orange pointer" onclick='DingDanXinXi.callGenerationRec("DingDanXinXi.getGenerationInfos","3")'></i> <i class="iconfont icon-lanya pointer" style="color:#34cdef" onclick='DingDanXinXi.callGenerationRec("DingDanXinXi.getGenerationInfos","1")'></i> <i class="iconfont icon-nfc pointer" style="color:#77dc55" onclick='DingDanXinXi.callGenerationRec("DingDanXinXi.getGenerationInfos","2")'></i></span></p></div><div class="card-camera" onclick='$("#avatar").click()'><div class="card-box" id="face-sdf23sd"><i class="iconfont"></i></div><p>正面人脸照</p></div><input type="file" accept="image/*;" capture="camera" id="avatar" onchange="DingDanXinXi.camera()" style="position:absolute;top:-9999rem" name="avatar"></div></div><div class="form-group"><div class="icon-label"><i class="iconfont icon-bianji"></i></div><div class="wrapper"><input class="form-control" placeholder="备注" type="text" name="remark"><div class="other"></div></div></div></form><script>var DingDanXinXi=function(){var e=function(e){return e.getFullYear()+"-"+(e.getMonth()+1>=10?e.getMonth()+1:"0"+(e.getMonth()+1))+"-"+e.getDate()};return template.helper("toString",function(e){return JSON.stringify(e)}),{init:function(){App.initSelect(),$("#container-dingDanXinXi").find('input[name="orderTime"]').calendar({minDate:e(new Date),onOpen:function(){$("body").append('<div id="picker-mask" class="weui-mask weui-mask--visible" style="z-index:900;"></div>')},onClose:function(n){$("#picker-mask").remove(),$.ajax({url:App.urls.businessLibrary.queryTimeRange,type:"post",dataType:"json",data:JSON.stringify({appointdate:e(new Date(n.value[0])),prodspecid:"9"})}).done(function(e){if(App.checker(e.health)){$("#sdfwer").show().find("input").attr({"data-options":JSON.stringify(e.data)});var n=$("#sdfwer").find('input[name="timeRange"]');n.val("").next(".input-label").removeClass("color-green").html(n.prop("placeholder"))}}).fail(function(){App.toastr("受理时段，初始化失败","forbidden")})}}),App.removeLoader()},matchFace:function(){if(0!=$("#id-kksiwes").children("img").size()&&0!=$("#face-sdf23sd").children("img").size()){App.loader();var e={idCard:$("#id-kksiwes").children("img").attr("src"),avatar:$("#face-sdf23sd").children("img").attr("src")};$.ajax({url:App.urls.businessLibrary.matchFace,type:"post",dataType:"json",data:JSON.stringify(e)}).done(function(e){App.checker(e.health)&&$("#matchRate").html(e.matchRate)}).always(function(){App.removeLoader()})}},camera:function(){var e=$("<img/>"),n=new FileReader,a=/^(?:image\/bmp|image\/gif|image\/jpeg|image\/png)$/i;if(n.onload=function(n){e.prop("src",n.target.result),App.loader()},0!==document.getElementById("avatar").files.length){var i=document.getElementById("avatar").files[0];if(!a.test(i.type))return void App.toastr("只支持图片!","forbidden");n.readAsDataURL(i),e[0].onload=function(){var n=e[0].width,a=e[0].height,i=document.createElement("canvas"),t=i.getContext("2d");i.width=n,i.height=a;var r=0,o=0,d=n,s=a,c=0,p=0,l=n,m=a;t.drawImage(e[0],r,o,d,s,c,p,l,m);var f=i.toDataURL("image/jpeg",.6);$("#face-sdf23sd").html($("<img />").prop({src:f,name:"avatar"}).css({width:"100%"})).css({lineHeight:0}),DingDanXinXi.matchFace(),App.removeLoader()}}},callGenerationRec:function(e,n){var a=new Array(1);a[0]=e,a[1]=n,MyPlugin.getGenerationInfos(a,function(e){},function(e){})},getGenerationInfos:function(e,n,a,i){$("#id-kksiwes").html($("<img />").prop({src:$("#face-sdf23sd").children("img").attr("src"),name:"idcard"}).css({width:"100%"})).css({lineHeight:0}),DingDanXinXi.matchFace()},showModal1:function(){App.modal({url:App.modules.common.queryFaZhanRen,data:{selector:'#container-dingDanXinXi input[name="faZhanRenName"]'}})}}}();DingDanXinXi.init()</script>