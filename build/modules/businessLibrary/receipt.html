<div class="modal"><div class="modal-header"><i class="iconfont icon-huizhi"></i> 回执 - 业务受理协议</div><div class="modal-footer"><button href="javascript:;" class="weui-btn weui-btn_plain-primary" onclick="Receipt.signature(this)" id="ksiekl">手写签名</button> <button class="weui-btn weui-btn_primary" id="btn-save" data-loading-text="保存回执..." onclick="Receipt.save()">保存回执</button></div><div class="modal-body" style="padding:2%"><img src="/yxs_service/img/holder.jpg" width="100%" id="hitarea"><div class="hide" id="hide992"></div></div></div><script src="/yxs_service/plugins/pinchzoom.js"></script><script>var Receipt=function(){var e=$("#hitarea").closest('div[data-role="pie"]');$("#hitarea").closest(".modal-body");return{init:function(){e.find(".weui-popup__modal").transitionEnd(function(){$.ajax({url:App.urls.businessLibrary.getAgreement,type:"post",dataType:"json",data:{}}).done(function(e){var t=$("#hitarea").attr({src:e.pic});t.load(function(){$.getScript("/yxs_service/plugins/pinchzoom.js",function(){new RTP.PinchZoom($("#hitarea"),{}),App.removeLoader()})})})})},save:function(){if(0==$("#hide992").children("img").size())return void App.toastr("您还未签名","forbidden");var e=$("#btn-save").button("loading");$.ajax({url:App.urls.businessLibrary.saveReceipt,type:"post",dataType:"json",data:JSON.stringify({signature:$("#hide992").children("img").attr("src")})}).done(function(){e.button("reset"),$.confirm("回执保存成功，前往收银台",function(){$("#btn-save").closest('[data-role="pie"]').find(".modal-header .icon-close").click()},function(){}),FormalOrder.state.receipt=!0})},signature:function(){App.modal({url:App.modules.common.signaturePad,data:{button:"#ksiekl",selector:"#hide992"},reload:!1})}}}();Receipt.init()</script>