var FormalOrder=function(){var e,t=1,a=!0,n=!1,i=function(){$("#nav>li>a").bind("click",function(){var e=$(this);t=$("#nav>li>a").index(this)+1,e.parent("li").addClass("active").siblings("li").removeClass("active"),$(e.data("target")).addClass("active").siblings(".tab-pane").removeClass("active"),r(t)})},r=function(e){var t={},a=['<button class="weui-btn weui-btn_plain-primary" onClick="FormalOrder.prev()" id="btn-prev">上一步</button>','<button class="weui-btn weui-btn_primary" onClick="FormalOrder.next()" id="btn-next" data-loading-text="下一步...">下一步</button>','<button class="weui-btn weui-btn_plain-primary" onClick="App.modal({url: App.modules.businessLibrary.receipt,data:\'\',reload:false})">回执</button>','<button class="weui-btn weui-btn_primary" onClick="FormalOrder.charge()">收费</button>'],i="";switch(e){case 1:t={url:App.modules.businessLibrary.kuanDaiXinXi,container:"#tab1",reload:!1},i=a[0]+a[1];break;case 2:t={url:App.modules.businessLibrary.keXuanBao,container:"#tab2",reload:!1},i=a[0]+a[1];break;case 3:t={url:App.modules.businessLibrary.dingDanXinXi,container:"#tab3",reload:!1},i=a[0]+a[1];break;case 4:t={url:App.modules.businessLibrary.shouYinTai,container:"#tab4",reload:!0},i=a[0]+a[2]+a[3]}App.includeHtml(t),$(".es-action-bar").html(i),n=!1},o=function(){return $("#nav>li").index($("#nav>li.active")[0])+1},s=function(t){if(1==+t){if($("#tab1").find(".form-group input").each(function(){return""==$(this).val()?(App.toastr($(this).attr("placeholder"),"forbidden"),a=!1,!1):void(a=!0)}),a&&!$("#lskowel").hasClass("checked"))return a=!1,void App.toastr("宽带账号未校验","forbidden");a&&$("#lskowel").hasClass("checked")&&(a=!0);var i=App.serialize($("#tab1").find("form").serialize()),r=App.serialize2("#tab1");a&&(e=$("#btn-next").button("loading"),$.ajax({url:App.urls.businessLibrary.submitKuanDaiXinXi,async:!1,type:"post",contentType:"application/json; charset=UTF-8",dataType:"json",data:JSON.stringify($.extend(!0,{},{token:FormalOrder.state.token},i,r))}).done(function(e){App.checker(e.health)&&(FormalOrder.state.token=e.data.token,n=!0,a=!1)}).always(function(){e.button("reset")}))}else if(2==+t){if(0==$("#container-keXuanBao-selected").children(".form-group").size()?(App.toastr("未选中","forbidden"),a=!1):$("#container-keXuanBao-selected").children(".form-group[data-config]").size()!=$("#container-keXuanBao-selected").children('.form-group:has(".circle-button")').size()?(App.toastr("参数未配置","forbidden"),a=!1):a=!0,a){e=$("#btn-next").button("loading");var r=[];$("#container-keXuanBao-selected").children(".form-group").each(function(){var e={};e.id=$(this).data("id"),$(this).data("config")&&(e.config=$(this).data("config")),r.push(e)}),$.ajax({url:App.urls.businessLibrary.submitKeXuanBao,async:!1,type:"post",contentType:"application/json; charset=UTF-8",dataType:"json",data:JSON.stringify($.extend(!0,{},{token:FormalOrder.state.token},{list:r}))}).done(function(e){App.checker(e.health)&&(FormalOrder.state.token=e.data.token,n=!0,a=!1)}).always(function(){e.button("reset")})}}else if(3==+t){if($(":input[data-type]").each(function(){$(this).trigger("change")}),$(".has-error").size()>0)return void(a=!1);if(a=!0,2!=$("#container-dingDanXinXi").find(".card-box > img").size())return App.toastr("经办人信息错误","forbidden"),void(a=!1);if(a=!0,$("#container-dingDanXinXi").find(".form-group input").filter(function(){return"remark"!=$(this).attr("name")}).each(function(){return""==$(this).val()?(App.toastr($(this).attr("placeholder"),"forbidden"),a=!1,!1):void(a=!0)}),a){e=$("#btn-next").button("loading");var i=App.serialize(decodeURIComponent($("#container-dingDanXinXi").serialize())),r=App.serialize2("#tab4");$.ajax({url:App.urls.businessLibrary.submitDingDanXinXi,async:!1,type:"post",contentType:"application/json; charset=UTF-8",dataType:"json",data:JSON.stringify($.extend(!0,{},{token:FormalOrder.state.token},i,r))}).done(function(e){App.checker(e.health)&&(FormalOrder.state.token=e.data.token,n=!0,a=!1)}).always(function(){e.button("reset")})}}else 4==+t&&(n=!0)};return{init:function(){i(),$("#nav>li>a").eq(0).click()},prev:function(){var e=1==o()?0:+t-2;$("#nav>li>a").eq(e).click()},next:function(){if(s(o()),n){var e=o()==$("#nav>li").size()?$("#nav>li").size():o();$("#nav>li>a").eq(e).click()}},charge:function(){void 0!=FormalOrder.state.receipt&&0!=FormalOrder.state.receipt||App.toastr("回执未提交","forbidden")},state:{token:""}}}();