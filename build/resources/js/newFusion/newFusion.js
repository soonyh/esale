var NewFusion=function(){var n,t=1,e=!0,i=!1,a=function(){$("#nav>li>a").bind("click",function(){var n=$(this);t=$("#nav>li>a").index(this)+1,n.parent("li").addClass("active").siblings("li").removeClass("active"),$(n.data("target")).addClass("active").siblings(".tab-pane").removeClass("active"),o(t)})},o=function(n){var t={},e=['<button class="weui-btn weui-btn_plain-primary" onClick="NewFusion.prev()" id="btn-prev">上一步</button>','<button class="weui-btn weui-btn_primary" onClick="NewFusion.next()" id="btn-next" data-loading-text="下一步...">下一步</button>','<button class="weui-btn weui-btn_plain-primary" onClick="App.modal({url: App.modules.newFusion.receipt,data:\'\'})">回执</button>','<button class="weui-btn weui-btn_primary" onClick="NewFusion.charge()">收费</button>'],a="";switch(n){case 1:t={url:App.modules.newFusion.taoCanLieBiao,container:"#tab1",reload:!1},a=e[1];break;case 2:t={url:App.modules.newFusion.selectProduct,container:"#tab2",reload:!1},a=e[0]+e[1];break;case 3:t={url:App.modules.newFusion.xinXiTianXie,container:"#tab3",reload:!1},a=e[0]+e[1];break;case 4:t={url:App.modules.newFusion.dingDanXinXi,container:"#tab4",reload:!1},a=e[0]+e[1];break;case 5:t={url:App.modules.newFusion.shouYinTai,container:"#tab5",reload:!0},a=e[0]+e[2]+e[3]}App.includeHtml(t),$(".es-action-bar").html(a),i=!1},r=function(){return $("#nav>li").index($("#nav>li.active")[0])+1},s=function(t){if(1==+t){if(""==$("#tab1").find("form").serialize())return void App.toastr("未选择套餐","forbidden");n=$("#btn-next").button("loading"),$.ajax({url:App.urls.newFusion.submitTaoCan,async:!1,type:"post",dataType:"json",data:JSON.stringify(App.serialize($("#tab1").find("form").serialize()))}).done(function(t){App.checker(t.health)&&(NewFusion.state.token=t.data.token,NewFusion.state.roles=$("#tab1").find(":input:checked").data("roles"),n.button("reset"),i=!0)})}else if(2==+t){if($("#tab2").find(".page-part").each(function(){var n=$(this).find('.input-label[data-role="title"]').html(),t=+$(this).data("max"),i=+$(this).data("min"),a=+$(this).find(".sub-area").find("input:checked").size(),o=+$(this).find(".spinbox").spinbox("value");return a+o>t?(App.toastr(n+"个数不能大于"+t,"forbidden"),e=!1,!1):a+o<i?(App.toastr(n+"个数不能小于"+i,"forbidden"),e=!1,!1):void(e=!0)}),e){n=$("#btn-next").button("loading");var a={token:NewFusion.state.token};$("#tab2").find(".page-part").each(function(){var n=App.serialize($(this).find(":input").serialize());switch(+$(this).data("role")){case 1:a.mobile=n;break;case 2:a.boardband=n;break;case 3:a.tianYiGaoQin=n}}),$.ajax({url:App.urls.newFusion.submitSelectProduct,async:!1,type:"post",dataType:"json",data:JSON.stringify(a)}).done(function(t){App.checker(t.health)&&(NewFusion.state.token=t.data.token,n.button("reset"),i=!0,e=!1)})}}else if(3==+t){if(0==$("#container-keXuanBao-selected").children(".form-group").size()?(App.toastr("未选中","forbidden"),e=!1):$("#container-keXuanBao-selected").children(".form-group[data-config]").size()!=$("#container-keXuanBao-selected").children('.form-group:has(".circle-button")').size()?(App.toastr("参数未配置","forbidden"),e=!1):e=!0,e){n=$("#btn-next").button("loading");var o=[];$("#container-keXuanBao-selected").children(".form-group").each(function(){var n={};n.id=$(this).data("id"),$(this).data("config")&&(n.config=$(this).data("config")),o.push(n)}),$.ajax({url:App.urls.newFusion.submitKeXuanBao,async:!1,type:"post",dataType:"json",data:JSON.stringify($.extend(!0,{},{token:NewFusion.state.token},{list:o}))}).done(function(t){App.checker(t.health)&&(NewFusion.state.token=t.data.token,n.button("reset"),i=!0,e=!1)})}}else if(4==+t){if($(":input[data-type]").each(function(){$(this).trigger("change")}),$(".has-error").size()>0)return void(e=!1);if(e=!0,2!=$("#container-dingDanXinXi").find(".card-box > img").size())return App.toastr("经办人信息错误","forbidden"),void(e=!1);if(e=!0,$("#container-dingDanXinXi").find(".form-group input").filter(function(){return"remark"!=$(this).attr("name")}).each(function(){return""==$(this).val()?(App.toastr($(this).attr("placeholder"),"forbidden"),e=!1,!1):void(e=!0)}),e){n=$("#btn-next").button("loading");var o=App.serialize(decodeURIComponent($("#container-dingDanXinXi").serialize()));$("#container-dingDanXinXi").find(".card-box > img").each(function(){"avatar"==$(this).attr("name")&&(o.avatar=$(this).prop("src"))}),$.ajax({url:App.urls.newFusion.submitDingDanXinXi,async:!1,type:"post",dataType:"json",data:JSON.stringify($.extend(!0,{},{token:NewFusion.state.token},o))}).done(function(t){App.checker(t.health)&&(NewFusion.state.token=t.data.token,n.button("reset"),i=!0,e=!1)})}}else 5==+t&&(i=!0)};return{init:function(){a(),$("#nav>li>a").eq(0).click()},prev:function(){var n=1==r()?0:+t-2;$("#nav>li>a").eq(n).click()},next:function(){if(s(r()),i){var n=r()==$("#nav>li").size()?$("#nav>li").size():r();$("#nav>li>a").eq(n).click()}},charge:function(){void 0!=NewFusion.state.receipt&&0!=NewFusion.state.receipt||App.toastr("回执未提交","forbidden")},state:{token:"",roles:null}}}();